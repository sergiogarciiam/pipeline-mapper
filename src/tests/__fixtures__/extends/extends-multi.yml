stages:
  - prepare
  - build
  - test1
  - test2

.base1:
  stage: test1
  needs: [build]
  rules:
    - if: '$CI_COMMIT_REF_NAME == "main"'

.base2:
  stage: test2
  needs: [prepare]
  rules:
    - if: '$CI_COMMIT_REF_NAME == "dev"'
      when: always

prepare:
  stage: prepare

build:
  stage: build

test1:
  extends: [.base1, .base2]

test2:
  stage: test2
  needs: [test1]
  extends: [.base1]